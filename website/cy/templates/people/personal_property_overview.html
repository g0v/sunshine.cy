{% extends "common/person_info.html" %}
{% load extras %}

{% block title %}
    {% if reports and cht %}
        <title>{{reports.0.name}}的{{cht}}申報紀錄</title>
        <meta property="og:title" content="{{reports.0.name}}的{{cht}}申報紀錄"/>
        <meta itemprop="name" content="{{reports.0.name}}的{{cht}}申報紀錄">
    {% elif reports %}
        <title>{{reports.0.name}}的財產申報總覽</title>
        <meta property="og:title" content="{{reports.0.name}}的財產申報總覽"/>
        <meta itemprop="name" content="{{reports.0.name}}的財產申報總覽">
    {% else %}
        <title>財產申報紀錄</title>
        <meta property="og:title" content="財產申報紀錄"/>
        <meta itemprop="name" content="財產申報紀錄">
    {% endif %}
{% endblock title %}

{% block person_detail %}
<h3>{{reports.0.name}}<small>（任{{reports.0.department}}-{{reports.0.title}}）</small>的財產申報總覽</h3>
    <table class="table table-bordered sortable" >
        <thead>
            <tr>
                <th rowspan=2 style="background-color: #CCFFCC;width: 10%">財產種類</th>
                <th colspan="{{date_union|length}}" style="background-color: #CCFFCC;width: 90%">申報日期</th>
            </tr>
            <tr style="background-color: #CCFFFF;">
            {% for date in date_union %}
                <th>{{date|date:"Y-m-d"}}</th>
            {% endfor %}
            </tr>
        </thead>
        <tbody>
        {% for category in summaries %}
            {% for summary in category %}
                {% with index=summary.index %}
                {% ifchanged index %}
                </tr><tr>
                    <td style="text-align:center; vertical-align:middle;"><a href="{% url 'people:personal_property' name=reports.0.name index=index %}"><h4>{{index|personal_property_summary:'cht'}}</h4></a></td>
                {% endifchanged %}
                {% if summary.count %}
                    <td style="text-align:center; vertical-align:middle;">
                        {{summary.count}}{{index|personal_property_summary:'count_unit'}}
                        {% if summary.total %}
                        <br><abbr title="{{ summary.total|floatformat }}"><span class="{{index|personal_property_summary:'zhutil_unit'}}">{{summary.total}}</span></abbr>{{index|personal_property_summary:'total_unit'}}
                        {% endif %}
                        {% if index|personal_property_summary:'remark' %}
                        &nbsp;({{summary.total|multiply:0.3025|floatformat}}坪)
                        {% endif %}
                    </td>
                {% else %}
                    <td>&nbsp;</td>
                {% endif %}
                {% endwith %}
            {% endfor %}
        {% empty %}
            <p class="lead text-error">目前只有土地、建物、股票三種財產申報資料料，敬請期待，歡迎跳坑加速開發~!!</p>
        {% endfor %}
        </tbody>
    </table>
{% endblock person_detail %}

{% block script %}
    <link href="//cdn.jsdelivr.net/jquery.datatables/1.9.4/css/jquery.dataTables.css" rel="stylesheet">
    <link href="//cdn.jsdelivr.net/jquery.datatables/1.9.4/css/jquery.dataTables_themeroller.css" rel="stylesheet">
    <script src="//datatables.net/download/build/nightly/jquery.dataTables.js"></script>
    <script src="https://s3-ap-northeast-1.amazonaws.com/twly.tw/zhutil.min.js"></script>
    <script>
        $(document).ready( function() {
            $('#datatable').dataTable({
                "sDom": "<'row'<'span6'f><'span6'i>r>t",
                "sPaginationType": "bootstrap",
                "sScrollY": "400px",
                "bPaginate": false,
                "aaSorting": [[0, "desc"]]
            });
            $('.price').each(function(index,ele){
                var number = $(ele).text()
                zh_number = zhutil.approximate(number, {base: '億', extra_decimal: 2});
                $(ele).replaceWith(zh_number)
            })
            $('.area').each(function(index,ele){
                var number = $(ele).text()
                , zh_number = zhutil.approximate(number, {base: '萬', extra_decimal: 2});
                $(ele).replaceWith(zh_number)
            })
        });
    </script>
    {{ block.super }}
{% endblock script %}
